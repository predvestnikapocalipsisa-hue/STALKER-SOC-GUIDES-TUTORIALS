-- -*- mode: lua; coding: windows-1251-dos -*-

Данный гайд предполагает, что вы владеете базовыми навыками модостроя и примерно понимаете, что нужно делать и служит лищь шпаргалкой. 

https://web.archive.org/web/20220702014753/http://stalkerin.gameru.net/wiki/index.php?title=%D0%A7%D0%B0%D1%81%D1%82%D1%8C_1#.D0.A1.D1.85.D0.B5.D0.BC.D0.B0_walker

Путь path_walk, по которому walker ходит.
Путь path_look, состоящий из точек, в которые walker смотрит.

Как выглядят точки в текстовом варианте:
[test_walk]
points = p0
p0:flags = 0x1
p0:name = name00
p0:position = -152.0,-18.0,-144.3
p0:game_vertex_id = 45
p0:level_vertex_id = 98126

[test_look]
points = p0
p0:flags = 0x1
p0:name = name00 | a = guard_na
p0:position = -152.0,-18.0,-144.3
p0:game_vertex_id = 45
p0:level_vertex_id = 98126

в acdc точки пути нужно прописывать в файлах way_*.ltx

в сдк для указывания в точке дополнительных параметров нужно нажать на точку и перейти в Point Mode 

В точках путей можно задавать флаги, изменяющие поведение персонажа. Флаги задаются прямо в имени вейпоинтаа, например, 
name00| flag1| flag2

Флаги точек пути path_walk:
|count= число
Этим параметром можно задать  количество людей в точках kamp, raid
|a=state
Выбирает состояние тела при перемещении (Только из раздела "Ходячие состояния")
Список состояний можно взять в gamedata\scripts\state_lib.script
|p=percent
Вероятность остановиться в точке в процентах (0 – 100). По умолчанию 100, т.е. сталкер никогда не проходит мимо точек остановки.
|sig=name
Установить сигнал с именем name сразу по прибытию в точку (до поворота) для последующей его проверки с помощью поля on_signal логической схемы. Если нужно установить сигнал после поворота – используйте соответствующий флажок пути *path_look.

Чтобы персонаж говорил, перемещаясь по маршруту:
|s = имя_звуковой_схемы. Несколько тем можно перечислять через запятую.
Например state это звуковая схема из \gamedata\scripts\sound_theme.script 
Более подробно описано в Гайд по озвучке.txt

Флаги точек пути path_look:

|a =state
Выбирает состояние тела при стоянии (или сидении) на месте. (Из разделов "Стоячие" и "Сидячие" состояния)
Список состояний можно взять в gamedata\scripts\state_lib.script
|t=msec - время в миллисекундах, которое персонаж должен смотреть в заданную точку.
* – бесконечное время. Допустимы значения в диапазоне [1000, 30000], по умолчанию – 5000.
Для конечных (терминальных) вершин пути path_walk, у которых не более 1-й соответствующей точки path_look, значение t всегда считается бесконечным и его явно задавать не нужно.
|sig=name
После поворота в точку path_look, установить сигнал с именем name.
|syn
Наличие флажка задержит установку сигнала до тех пор, пока в точку с флажком syn не прибудут все персонажи с данным team-ом (team задается в виде текстовой строки в customdata). До тех пор, пока остальные персонажи не прибудут, ожидающей персонаж будет отыгрывать свою idle анимацию.
|sigtm=signal
Устанавливает сигнал при вызове time_callback-а state manager-ом. Соответственно, если t=0, то сигнал будет установлен после отыгрывания init анимации. Это используется, например, с анимацией press, которая состоит из двух частей: 1 - нажимаем на кнопку, 2 - опускаем руку.
В пути path_look можно сделать:
name00|a=press|t=0|sigtm=pressed
А затем переключить схему:
on_signal = pressed | другая_схема

Помимо флагов: count, s, a, p, t, sig, syn, sigtm
Есть и такие флаги в точках walk и look
   flag 0:•
   flag 1:•
   flag 2:•
   flag 3:•
   flad n:•
Начать хотеть бы с того, что если у вас всего один вейпоинт, а не маршрут  из нескольких точек, то нужно  в точку установить 0-нулевой флаг, это касается как walk так и look.
А глобально флаги нужны для синхронизации, например есть задача сделать  так, чтобы нпс дойдя до одной точки остановился  и проиграл анимацию, чтобы сделать  это без секции  remark достаточно сделать  маршрут path_walk из двух точек, и path_look также из двух, теперь в лук в первом поинте ставим 0-й флажок и ставим  какую-нибудь анимацию, в волк тоже 0-й флажок,  вторые поинты пока не трогаем. На деле выйдет так что нпс придя в вейпоинт с флагом 0 синхронизируются  с точкой лук у которой флаг 0 и отыграется анимация. 


Схема walker
Это базовая схема, по которой персонаж, перемещается по патрульному пути (path_walk) и останавливается в определенных точках и выполняет соответствующие действия.

[walker]
path_walk = <имя_пути> - основной путь, по которому ходит NPC
path_look = <имя_пути> - путь, куда смотрит NPC
team = <имя_команды> - команда для синхронизации
def_state_moving1 = <название_анимации> - состояние, в котором NPC движется к первой точке пути, если она близко (patrol по умолчанию)
def_state_moving2 = <название_анимации> - состояние, в котором NPC движется к первой точке пути, если она не слишком далеко (rush по умолчанию)
def_state_moving3 = <название_анимации> - состояние, в котором NPC движется к первой точке пути, если она далеко (sprint по умолчанию)
def_state_standing = <название_анимации> - дефолтное состояние в котором он стоит и смотрит на точку, если в этой точке не задана другое состояние.

В точках path_walk, которым соответствуют точки пути path_look (стоят одинаковые флажки) персонаж останавливается и смотрит в определенную точку, при этом отыгрывая (или не отыгрывая) определенную анимацию.

Пример использования схемы:
[walker@pri_followers_leader_wave1_wait]
path_walk = wave1_leader_walk2
path_look = wave1_leader_look2
def_state_moving1 = assault
def_state_moving2 = assault
team = followers

Логика из урока:
[smart_terrains]
none = true

[logic]
active = walker

[walker]
path_walk = my_way
path_look = my_look
on_timer = 40000 | walker1
on_info = {+my_info} walker1

[walker1]
path_walk = my_way1
on_signal = my_signal | %=main% walker

В логике [walker] нужно ставить 0-нулевые флажки в точки "path_walk" и "path_look", чтобы не было вылета, в асдс выглядит так p1:flags = 0x1, в сдк для их установки нужно перейти в Point Mode

%=main% это выполнение функции из \gamedata\scripts\xr_effects.script

Иногда бывает, что в первую точку нпс идёт еле как, а начиная со второй начинает бежать как нужно. Для этого есть:
def_state_moving1 = <название_анимации> - состояние, в котором NPC движется к первой точке пути, если она близко (patrol по умолчанию)
def_state_moving2 = <название_анимации> - состояние, в котором NPC движется к первой точке пути, если она не слишком далеко (rush по умолчанию)
def_state_moving3 = <название_анимации> - состояние, в котором NPC движется к первой точке пути, если она далеко (sprint по умолчанию)
def_state_standing = <название_анимации> - дефолтное состояние в котором он стоит и смотрит на точку, если в этой точке не задана другое состояние.

Анимации которые можно использоватьв логике из state_lib.script
Ходят:
patrol – просто идет
run - бежит          
walk – ходит без оружия
assault – бежит в денжере
raid – идет опустив ствол
raid_fire – идет в денжере
sprint – бежит в денжере
patrol_fire – патрулирует с оружие в руках
aneak_no_wpn сидя крадется без оружия
sneak_run сидя бежит с опущенной волыной
sneak – сидя крадется в денжере
rush – бежит и машет валыной
СТОИТ:
wait – просто стоит, дефолт
wait_trade – стоит и часто потирает руки, переминается
wait_na – стоит боком, типа недоверчиво
guard – валыну в руках крутит
guard_na – стоит на изготовке с оружием в руках
guard_fire – целиться куда смотрел при подходе, при разговоре поворачивается
threat – целиться куда смотрел
threat_heli – целиться в ГГ и при разговоре
threat_na – целиться но при разговоре убирает ствол
threat_fire – целиться куда смотрел
hide – целиться в валыну и играет ей
caution – руки облокотил на колени
choose – стоит свободно переминается, короче как обычный человек
press – тычит пальцем
ward – руки за спиной голова вниз
search – стоит, садиться и чтото ищет и опять заново
salut – стоит смирно, харя довольная
salut_free – подставляет руку в виску
prisoner – сидит как пленник типа Шустрый
hide_no_wpn – сидит руки на земле чето высматривает
hello – машет одной рукой (без валыны)
hello_wpn – в одной руке оружие а другой машет
refuse – пожимает плечами и разводит руки
claim – в одной руке оружие а другой подзывает, типа иди сюда
backoff – держит оружие в руках и машет рукой типа убери оружие, а потом показывает фак
suicide – сидит на коленях и пушка в руке у виска
punch – типа ударяет рукой
hide_s_left – сидтся в одной руке валына а другой показывает тихо!
hide_s_right – сидит в одной руке оружие а другой чето делает
dynamite – закладывает динамит
binocular – смотрит в бинокль
hide_rac – сидит в одной руке оружие в другой рация
wait_rac – стоя говорит в рацию
guard_rac – стоит в одной руке оружие в другой рация
probe – смотрит на прибор который держит в руках
probe_1 - смотрит на прибор который держит в руках
probe_2 - смотрит на прибор который держит в руках
probe_3 - смотрит на прибор который держит в руках
hands_up – руки вверх
Сидят:
sit
sit_knee
sit_ass
sleep
sleep_sit
eat_bread
eat_vodka
eat_energy
eat_kolbasa
guitar
Раненный:
Wounded – сидит и держиться за грудь
wounded_heavy – лежит как раненный
wounded_heavy_2 – лежит и держиться
wounded_heavy_3 – лежит скрючевшись
wounded_zombie – очень низко сидит одной рукой упирается в землю другой держиться за грудь
help_me - очень низко сидит одной рукой упирается в землю другой держиться за грудь, потом рукой машет
trans_0 – сидит на коленях, там же руки и покачивается
trans_1 – сидит на коленях руки там же и крутит торсом
trans_zombied - сидит на коленях руки там же и машет головой (короткая)
Пси раненный:
psy_pain – сидит на коленях, руки за голову, мотает ,бьет себя по голове
psy_armed – сидит на коленях, руки за голову, мотает ,бьет себя по голове только с оружием
psycho_pain – держиться за голову
psycho_shoot - опирается рукой в землю потом стреляет себе в висок и умирает
bar_fas– стоит облокотившись типа на стойку
bar_left – стоит облокотившись левой рукой на стойку
bar_head – стоит локтями уперся на стоику в одной руке держит голову типа спит
bar_sleep – руки сложены на стойке голова опущена
bar_right – правая рука на стойке а на руке голова, левая на стойке
doctor_wakeup – когда доктор склоняется над Стрелком и базарит


