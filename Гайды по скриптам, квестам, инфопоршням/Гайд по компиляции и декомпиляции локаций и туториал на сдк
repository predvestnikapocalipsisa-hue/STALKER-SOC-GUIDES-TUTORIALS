-- -*- mode: lua; coding: windows-1251-dos -*-
========================================================= Установка СДК =======================================================================


Чтобы добавлять обьекты, удобно редактировать all spawn, добавлять растительность и делать прочие корректировки на локациях необходим Xray SDK 

  Однако чтобы запустить локацию в Level editor необходимо перевести ее в формат сдк

У сдк есть разные версии

0.4 - Тень Чернобыля
0.5 - Чистое Небо
0.7 - Зов Припяти

Так же есть модификации на существующие версии сдк

0.8 (УСТАРЕЛО) - Зов Припяти 
Hybrid Xray (СЫРО) - Зов Припяти, Тень Чернобыля. (полностью копирует 0.8 но имеет кривейший порт на Тень Чернобыля)
Ix-ray sdk (Лучший сдк на данный момент) - Зов Припяти (является полностью доработанной версией сдк 0.8 + тонна новых фишек) 
Sdk 0.4 SMG (Единственный хорошо работающий вариант для ТЧ, но не имеющий правок интерфейса) - Тень Чернобыля 

Но сейчас мы будем разбирать только версию 0.4 SMG:

  https://sites.google.com/view/xray-sdk-0-4-smg - ссылка на установку СДК 

После установки сдк, необходимо перевести локацию из папки levels в формат сдк в папку maps.

Для декомпиляции локации необходима прога converter: 

  https://drive.google.com/file/d/1hym03qaIgZt4gUpd7ve0pjpYIvYmYwdv/view?usp=sharing

Установив конвертер, нужно прописать нужные пути. Заходим в fsconverter.ltx

в самой первой строке, ставим путь к левел эдитору:

$sdk_root$		= false| false| D:\mygame\myinstal\sdk\X-Ray SDK\level_editor\

сохраняем, и заходим в converter.ini

Тут, в начале есть список всех билдов сталкера, но нам нужен релизный билд

default				= 2947_config

Находим строчку "2947_config" ниже и видим такие параметры, которые нужно отредактировать под расположение своей игры:

; 2947+ (финалка включая обновления)
[2947_config]:2945_config
$game_data$			= D:\game\instal\STALKER COP\S.T.A.L.K.E.R. Call of Pripyat\S.T.A.L.K.E.R. Shadow of Chernobyl\Stalker-soc-epilogue-of-the-last-dawn\gamedata\
$game_levels$			= D:\game\instal\STALKER COP\S.T.A.L.K.E.R. Call of Pripyat\S.T.A.L.K.E.R. Shadow of Chernobyl\Stalker-soc-epilogue-of-the-last-dawn\gamedata\levels\
spawn_version = soc

Когда пути прописаны, можно приступать к декомпиляции.

Папка с локацией должна лежать в levels игры которую вы указали в 2947_config.

залезаем в батник converter.bat

converter -level default:pripyat_full -out pripyat_full1 -mode le -with_lods
pause

здесь нам вместо pripyat_full надо указать название нашей локации.
-level default:pripyat_full --- это название локи в папке левелс
-out pripyat_full1 --- это название локи в сдк 

тег -with_lods означает что вместе с локацией декомпилируются и ее лоды. Но они могут не подходить, можно не включать этот параметр. Лоды всегда можно сделать или пересоздать в сдк.

Начав декомпиляцию локи, могут случится какие-либо ошибки, исправление которых нужно искать в интернете.

Но если все прошло успешно, то можно радоватся и заходить в сдк.

В сдк нажимаем file - open и выбираем сейв, название которого мы указывали в -out pripyat_full1.

Тут так же могут быть различные ошибки, но если мы декомпилируем локации оригинальной трилогии то все должно пройти гладко,
если же вы адаптируете локацию из интернета или из других модов то вы должны быть готовы к проблемам и их исправлением.

Сделав все правки на локации (как их делать будет описано позже в статье, а так же в уже существующих файлах описаны методы редактирования локаций)
мы должны приступить к компиляции.

нажимаем scene - options и ставим настройки компиляции - draft, medium, high

драфт - плохое качество, используется только для быстрых тестов.

Для начала, локацию нужно сбилдить в сдк. Нажимаем compile - build (так же есть другие категории, но если нам нужно скомпилировать новые обьекты и геометрию то билд обязателен.
Билд полностью очищает все остальные файлы в папке уровня в levels) 

После билда нам нужно воспользоватся SkyCompilers, по сути можно воспользоватся и оригинальными батниками. Но это будет менее удобно. 

  https://drive.google.com/file/d/1ZmckMkCK6uyIadZ9Y1Td5e6p3PQ4k1zr/view - ссылка на установку компиляторов

Распаковываем компиляторы в папку левел эдитора, и запускаем Compiler_Menu.cmd

Выбираем локацию которую сбилдили, можно включить или выключить ускорители вычислений, дальше переходим к отделу "геометрия"

здесь нужно поставить галочки на 2 пунктах:

- Пропускать отсутствующие текстуры 
- Пропускать invalid faces 

так же можно добавить дополнительные ключи, если вы их знаете
нажимаем "начать компиляцию" и ждем. Геометрия - самый долгий этап.

Скомпилив геометрию, заходим в "трава" и компилируем траву, если она есть. Тут ставить галочки не надо

Дальше аи-сетка, ставим "сборка аи сетки" и компилируем. 

Последним идет спавн, тут ставим одну галочку:

- Отключить конфликты

после чего в дополнительных спавнах нажимаем "добавить" и выбираем все локации которые есть, по крайней мере, локации спавн которых вы хотите обьеденить. 

В имени создаваемого спавна ставим назвние all.spawn (то есть убираем галочку "по умолчанию")
После чего собираем графы и спавн.

========================================================= Перенос изменений из СДК =======================================================================

Если вы дошли до этого момента, у вас все прекрасно работало и вы смоги скомпилировать ребилд локации, то вы молодец и пришло время переноса данных из сдк в игру.

Для этого заходим в gamedata левел эдитора, выделяем следующие файлы:

- game.graph
- папка spawns 
- папка levels 

копируем, и переносим в геймдату игры. 

Все, теперь все настройки применены и вы можете с чистой совестью заходить в игру и наслаждатся вышим васянским (или не очень) ребилдом. 

========================================================= Обзор на СДК =======================================================================

Сдк на самом деле довольно легкий в освоении. Запустив локацию, для перемещения нужно будет выбрать один из режимов сверху: P A F 

    самым оптимальным вариантом по моему мнениюю является P

Далее, зажав клавишу shift и две кнопки мыши мы можем вращать камерой, а зажав shift и левую кнопку мыши передвигатся.
Справа мы видим категории обьектов:

object 
spawn element
sector
...

чтобы взаимодействовать с определенной категорией, необходимо выбрать ее справа.
Так же в SMG появилась возможность скрывать определенные категории глазком

Чтобы добавить обьект, выбираем вкладку object, выбираем в списке снизу наш обьект, включаем сверху модификаторы "object snap toggle" и "moving to snap toggle" (необязательно, нужно для фиксации обьекта сразу на тиррейне.
В случае если это не работает, выделаем террейн, и в списке snap list нажимаем commands - add selected to list). Там же нажимаем на иконку "Чайника" под названием "add". И тыкаем на любое место локации. Так же вместо
нажатия на чайник можно нажать горячую клавишу "a"

Когда поставили обьект, мы можем его передвинуть. Выбираем иконку со стрелочками "move", выбираем по какой оси его передвигать - X Y Z (есть еще ZX) и водим мышкой. 

можем его повернуть выбрав круговую стрелочку "rotate", и так же выбрав ось - X Y Z (ZX не работает)

и увеличить/уменьшить (работает не на всех обьектах), по осям - X Y Z (ZX работает). Еще можно выбрать увеличения, включив или выключив кнопку с двумя прямоугольниками "non-uniform scale".


Чтобы залезть в свойства обьекта, мы должны выделить его и нажать Enter, ну или нажав правой кнопкой мыши - properties 

==============================================================================================================================================================
