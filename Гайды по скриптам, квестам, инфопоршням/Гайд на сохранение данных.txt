-- -*- mode: lua; coding: windows-1251-dos -*-
–í –¥–≤–∏–∂–∫–µ X-Ray Lua-—Å–∫—Ä–∏–ø—Ç—ã –ø–æ–∑–≤–æ–ª—è—é—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏ –∑–∞–≥—Ä—É–∂–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ. –≠—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–Ω–æ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–≤–µ—Å—Ç–æ–≤, –≥–¥–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ö—Ä–∞–Ω–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è NPC, –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–ª–∏ –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–≤—ã—Ö —Ñ–ª–∞–≥–æ–≤ –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏.

üîπ –°–∏—Å—Ç–µ–º–∞ pstorüîπ
–í S.T.A.L.K.E.R. —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø—Ä–æ—Å—Ç–∞—è, –Ω–æ –º–æ—â–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞, –∫–æ—Ç–æ—Ä–∞—è –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤ xr_logic.script –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∞–∫—Ç–æ—Ä–∞ (db.storage).

üîπ –ì–ª–∞–≤–Ω—ã–π –Ω—é–∞–Ω—Å. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤ 8 –ö–ë –Ω–∞ —á–∞–Ω–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
–≠—Ç–æ –∂—ë—Å—Ç–∫–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–≤–∏–∂–∫–∞ ‚Äî –≤—ã –Ω–µ –º–æ–∂–µ—Ç–µ –∑–∞–ø–∏—Å–∞—Ç—å –≤ –æ–¥–∏–Ω —á–∞–Ω–∫ –±–æ–ª–µ–µ 8192 –±–∞–π—Ç (8 –ö–ë). –ï—Å–ª–∏ –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è –ø—Ä–µ–≤—ã—Å–∏—Ç—å –ª–∏–º–∏—Ç –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ —á–µ—Ä–µ–∑ packet:w_...() ‚Äî –∏–≥—Ä–∞ –∞–≤–∞—Ä–∏–π–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π –≤–∏–¥–∞:
assertion failed: size < 8192

–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
xr_logic.pstor_store(obj, "variable_name", value)
obj ‚Äî –æ–±—ä–µ–∫—Ç, –æ–±—ã—á–Ω–æ db.actor (–∏–≥—Ä–æ–∫).
"variable_name" ‚Äî –∏–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫–∏.
value ‚Äî –∑–Ω–∞—á–µ–Ω–∏–µ, –º–æ–∂–µ—Ç –±—ã—Ç—å —á–∏—Å–ª–æ–º, —Å—Ç—Ä–æ–∫–æ–π –∏–ª–∏ –±—É–ª–µ–≤—ã–º —Ç–∏–ø–æ–º.

–ü—Ä–∏–º–µ—Ä: 
xr_logic.pstor_store(db.actor, "noclip_delay_time", 50)

–ó–∞–≥—Ä—É–∑–∫–∞ –∑–Ω–∞—á–µ–Ω–∏—è
local value = xr_logic.pstor_retrieve(obj, "variable_name", default_value)
–ï—Å–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ ‚Äî –≤–µ—Ä–Ω—ë—Ç—Å—è default_value.

–ü—Ä–∏–º–µ—Ä: 
local delay = xr_logic.pstor_retrieve(db.actor, "noclip_delay_time", 100)

–ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø:

-- –ø—Ä–∏–±–∞–≤–∏—Ç—å –∫ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É —Å—á—ë—Ç—á–∏–∫—É –∞–∫—Ç—ë—Ä–∞ 1
-- –≤—ã—Ö—ã–≤–∞—Ç—å sak.counter_add1("name")
function counter_add1(name)
        xr_logic.pstor_store(db.actor, name, xr_logic.pstor_retrieve(db.actor, name, 0) + 1)
end
--------------------------------------------------------------------------------------------------------------
-- –æ—Ç–Ω—è—Ç—å –æ—Ç —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Å—á—ë—Ç—á–∏–∫–∞ –∞–∫—Ç—ë—Ä–∞ 1 
-- –≤—ã–∑—ã–≤–∞—Ç—å sak.counter_del1("name")
function counter_del1(name)
        xr_logic.pstor_store(db.actor, name, xr_logic.pstor_retrieve(db.actor, name, 0) - 1)
end
--------------------------------------------------------------------------------------------------------------
–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º?
–î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ db.storage[npc_id].pstor ‚Äî —ç—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ Lua.
–ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∏–≥—Ä—ã (actor_binder:save) –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è xr_logic.pstor_save_all(), –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤—Å–µ –ø–∞—Ä—ã –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ –≤ –±–∏–Ω–∞—Ä–Ω—ã–π –ø–æ—Ç–æ–∫.
–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ ‚Äî xr_logic.pstor_load_all() –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∏—Ö.

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç—Ä–∏ —Ç–∏–ø–∞:
number ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–∞–∫ float
string ‚Üí –∫–∞–∫ –Ω—É–ª—å-—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞
boolean ‚Üí –∫–∞–∫ –±—É–ª–µ–≤–æ –∑–Ω–∞—á–µ–Ω–∏–µ
–ü–æ–ø—ã—Ç–∫–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥—Ä—É–≥–æ–π —Ç–∏–ø (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–∞–±–ª–∏—Ü—É) –≤—ã–∑–æ–≤–µ—Ç –æ—à–∏–±–∫—É.

–ê –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (actor_binder:load) –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è:
xr_logic.pstor_load_all(self.object, reader)
–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –≤–∞–º –Ω–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ ‚Äî –≤—Å—ë –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

–î–ª—è —É–¥–æ–±–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ \gamedata\scripts\_g.script –≤—Å—Ç–∞–≤—å—Ç–µ –≤ –∫–æ–Ω–µ—Ü:

-- –ø–æ–ª—É—á–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é 
function get_value(var_name, default_value)
  return xr_logic.pstor_retrieve(db.actor, var_name, default_value)
end

-- —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å\—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
function set_value(counter_name, value)
  xr_logic.pstor_store(db.actor, counter_name, value)
end

-- —É–¥–∞–ª–∏—Ç—å\–æ—á–∏—Å—Ç–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
function del_value(var_name)
  if not db.actor then
    abort("can't delete variable '%s', bacause actor is nil!", var_name)
  end
  
  local st = db.storage[db.actor:id()]
  if st.pstor and st.pstor[var_name] then
    st.pstor[var_name] = nil
  end
end

--' –°—á—ë—Ç—á–∏–∫ –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∫–≤–µ—Å—Ç–∞—Ö –∏ –ª—é–±—ã—Ö –ø—Ä–æ–≤–µ—Ä–∫–∞—Ö
function counter_handler(name, cnt)
	if name and cnt then
		local c = get_value(name, 0)
		if c >= cnt then
			del_value(name)
		return true
		end
	else
		return false
	end
end

-- –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
function name()
   return counter_handler("fff", 10)
end

-- –°—á—ë—Ç—á–∏–∫, –∫–æ—Ç–æ—Ä—ã–π —Ç–æ–ª—å–∫–æ —Å–≤–µ—Ä—è–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ
function counter_handler(name, cnt)
	if name and cnt then
		local c = xr_logic.pstor_retrieve(db.actor, name, 0)
		return c >= cnt
	else
		return false
	end
end

--' –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å—á—ë—Ç—á–∏–∫–∞, —Å—Ç–∞–≤–∏—Ç—Å—è –≤ —Ç–µ –º–µ—Å—Ç–∞ –≥–¥–µ —Ñ—É–Ω–∫—Ü–∏—è –¥–∞—Å—Ç —Ç—Ä—É, —Ç–æ–≥–¥–∞ –∫ —Å—á—ë—Ç—á–∏–∫—É –±—É–¥–µ—Ç –ø—Ä–∏–±–∞–ª–µ–Ω–æ 1
function counter_handler(counter_name, counter_limit)
  local cnt = get_value(counter_name, 0) + 1
  if cnt >= counter_limit then
    del_value(counter_name)
    return true
  else
    set_value(counter_name, cnt)
    return false
  end
end

-- –ü—Ä–∏–º–µ—Ä:
-- –∫–æ–ª–ª–±–µ–∫ –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–æ–≤
function actor_binder:use_object(obj)  
  local s_obj = obj:section() 
    if s_obj == "vodka" and not has_alife_info("vodka_counter_info") then 
        if counter_handler("vodka_counter", 30) then
            db.actor:give_info_portion("vodka_counter_info")
        end 
    end
end

–ï—â—ë —Å –æ—Ä–≥–∏–Ω–∞–ª–∞ –≤ \gamedata\scripts\xr_effects.script –µ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ inc_counter –∏ dec_counter, –ø—Ä–∏–±–∞–≤–∏—Ç—å –∫ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É —Å—á—ë—Ç—á–∏–∫—É –∞–∫—Ç—ë—Ä–∞ 1 –∏–ª–∏ –æ—Ç–Ω—è—Ç—å

–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –ª–æ–≥–∏–∫–µ:
[logic]
active = nil
on_death = death

[death]
on_info = %=inc_counter(fff)%

–≤ \gamedata\scripts\xr_conditions.script –µ—Å—Ç—å counter_greater —É –Ω–µ–≥–æ –Ω–∞–¥–æ –Ω–∞–±–∏—Ç—å –Ω–∞ 1 –±–æ–ª—å—à–µ —á–µ–º —É–∫–∞–∑–∞–Ω–æ, —Ç–∞–∫–æ–π –Ω—é–∞–Ω—Å

–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –ª–æ–≥–∏–∫–µ:
[logic]
active = sr_idle

[sr_idle]
on_info = {=counter_greater(my_counter:5)} %=spawn_npc%




üîπ–ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ê –° –ë–û–õ–¨–®–ò–ú–ò –í–û–ó–ú–û–ñ–ù–û–°–¢–Ø–ú–òüîπ

üóÉÔ∏è se_stor ‚Äî –†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è S.T.A.L.K.E.R. (–ú–û–î–£–õ–ò Artos(lua_helper+m_netpk+m_timers+se_stor))
se_stor ‚Äî —ç—Ç–æ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –≤ S.T.A.L.K.E.R., —Å–æ–∑–¥–∞–Ω–Ω–∞—è —Å–æ–æ–±—â–µ—Å—Ç–≤–æ–º (–≤ —á–∞—Å—Ç–Ω–æ—Å—Ç–∏ –ø–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º, Malandrinus –∏ xStream), –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è –∫–∞–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–º—É pstor –∏–∑ xr_logic.script.

–û–Ω–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –±–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö, –≤–∫–ª—é—á–∞—è —Å–ª–æ–∂–Ω—ã–µ —Ç–∏–ø—ã (—Ç–∞–±–ª–∏—Ü—ã, –≤–µ–∫—Ç–æ—Ä—ã, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏), –∞ —Ç–∞–∫–∂–µ –æ–±—Ö–æ–¥–∏—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤ 8 –ö–ë, –ø—Ä–∏—Å—É—â–µ–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º—É —á–∞–Ω–∫—É –∞–∫—Ç—ë—Ä–∞.

üîß –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö:
boolean ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–∞–∫ 1 –±–∞–π—Ç
number ‚Üí –≤—Å–µ–≥–¥–∞ –∫–∞–∫ float (4 –±–∞–π—Ç–∞)
–î–ª—è –æ—á–µ–Ω—å –±–æ–ª—å—à–∏—Ö —á–∏—Å–µ–ª —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ —Å—Ç—Ä–æ–∫—É: ""..1234567890
string ‚Üí –∫–∞–∫ null-terminated C-—Å—Ç—Ä–æ–∫–∞
–ú–∞–∫—Å. –¥–ª–∏–Ω–∞: ~8000‚Äì16000 –±–∞–π—Ç (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞)
table ‚Üí —Ç–æ–ª—å–∫–æ "–ø—Ä–æ—Å—Ç—ã–µ" —Ç–∞–±–ª–∏—Ü—ã:
–ë–µ–∑ –º–µ—Ç–∞—Ç–∞–±–ª–∏—Ü
–ë–µ–∑ —Ä–µ–∫—É—Ä—Å–∏–∏
–ö–ª—é—á–∏ –∏ –∑–Ω–∞—á–µ–Ω–∏—è ‚Äî —Ç–æ–ª—å–∫–æ –ø—Ä–∏–º–∏—Ç–∏–≤—ã (number, string, boolean)
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤ —Å—Ç—Ä–æ–∫—É (–≤–æ–∑–º–æ–∂–Ω–æ —Å —Å–∂–∞—Ç–∏–µ–º)
vector, CTime, binary chunk ‚Äî —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∏–≥—Ä–æ–≤—ã–µ —Ç–∏–ø—ã
‚ö†Ô∏è –í–∞–∂–Ω–æ: –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ –æ–¥–Ω–æ–≥–æ –ø–∞–∫–µ—Ç–∞ (—Ç–æ–∂–µ ~8 –ö–ë) —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —É–ø–∞–¥—ë—Ç ‚Äî –Ω–æ se_stor –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–±—ä–µ–∫—Ç–æ–≤-—Ö—Ä–∞–Ω–∏–ª–∏—â, —á—Ç–æ–±—ã –æ–±–æ–π—Ç–∏ —ç—Ç–æ. 

üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
1. –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –∏–≥—Ä–æ–≤–æ–π –æ–±—ä–µ–∫—Ç CUST_ST (clsid.custom_storage)
2. –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ storehouse
–í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –æ–±—â–µ–π —Ç–∞–±–ª–∏—Ü–µ se_stor.storehouse
–ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ ‚Äî —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç—Å—è –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ –æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ custom_storage-–æ–±—ä–µ–∫—Ç–æ–≤
–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ ‚Äî –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

üì• –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å API

‚û§ –ó–∞–ø–∏—Å—å
se_stor.set(var_name, value, f_check)
var_name ‚Äî –∏–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π (—Å—Ç—Ä–æ–∫–∞)
value ‚Äî –∑–Ω–∞—á–µ–Ω–∏–µ (–ª—é–±–æ–π –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ç–∏–ø)
f_check ‚Äî (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) —Ñ–ª–∞–≥ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑–º–µ—Ä–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é
–ß—Ç–æ–±—ã —É–¥–∞–ª–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é ‚Äî –ø–µ—Ä–µ–¥–∞–π—Ç–µ nil –∫–∞–∫ –∑–Ω–∞—á–µ–Ω–∏–µ: 

se_stor.set("old_flag", nil)

‚û§ –ß—Ç–µ–Ω–∏–µ
local val = se_stor.get(var_name, default_value)
–ï—Å–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ default_value –Ω–µ –∑–∞–¥–∞–Ω ‚Äî –≤–µ—Ä–Ω—ë—Ç nil

‚û§ –£–¥–æ–±–Ω—ã–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–≤ _G)
delay_time = GetVar("noclip_delay_time", 30)  
SetVar("noclip_delay_time", noclip_mode.delay_time)

üÜö –û—Ç–ª–∏—á–∏—è –æ—Ç pstor (–∏–∑ xr_logic)
–ú–µ—Å—Ç–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è
–í —á–∞–Ω–∫–µ –∞–∫—Ç—ë—Ä–∞ (8 –ö–ë –º–∞–∫—Å)
–í –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–∞—Ö (
CUST_ST
)
–¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
–¢–æ–ª—å–∫–æ –ø—Ä–∏–º–∏—Ç–∏–≤—ã
+ —Ç–∞–±–ª–∏—Ü—ã, –≤–µ–∫—Ç–æ—Ä—ã, –±–∏–Ω–∞—Ä–Ω—ã–µ —á–∞–Ω–∫–∏
–ú–∞–∫—Å. –æ–±—ä—ë–º
~7‚Äì7.5 –ö–ë (—Ä–µ–∞–ª—å–Ω–æ)
–¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏ –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω
–°–ª–æ–∂–Ω–æ—Å—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
–ü—Ä–æ—Å—Ç–∞—è
–¢—Ä–µ–±—É–µ—Ç –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∫–æ–Ω—Ñ–∏–≥–æ–≤
–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
–í—ã—Å–æ–∫–∞—è (–≤—Å—Ç—Ä–æ–µ–Ω–∞ –≤ —è–¥—Ä–æ)
–ó–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

üí° –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?
–ö–≤–µ—Å—Ç–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã —Å —Å–æ—Ç–Ω—è–º–∏ —Ñ–ª–∞–≥–æ–≤
–ü—Ä–æ–≥—Ä–µ—Å—Å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (—Å–∫–∏–ª–ª—ã, –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è, –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å –≤–Ω–µ —Ä—é–∫–∑–∞–∫–∞)
–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Å–æ–±—ã—Ç–∏—è, —Ç—Ä–µ–±—É—é—â–∏–µ —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–∫ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–π
–°–ª–æ–∂–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏–∫–∞ –∏–ª–∏ —Ä–µ–ø—É—Ç–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã
–ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–ø–∏—Å–æ–∫ —É–±–∏—Ç—ã—Ö –º–æ–Ω—Å—Ç—Ä–æ–≤ –ø–æ —Ç–∏–ø–∞–º, –∏–ª–∏ –∫–∞—Ä—Ç—É –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ª–æ–∫–∞—Ü–∏–π, pstor –±—ã—Å—Ç—Ä–æ –∏—Å—á–µ—Ä–ø–∞–µ—Ç –ª–∏–º–∏—Ç ‚Äî –∞ se_stor —Å–ø—Ä–∞–≤–∏—Ç—Å—è –ª–µ–≥–∫–æ. 

‚úÖ –í—ã–≤–æ–¥
se_stor ‚Äî —ç—Ç–æ must-have –¥–ª—è —Å–µ—Ä—å—ë–∑–Ω—ã—Ö –º–æ–¥–æ–≤ S.T.A.L.K.E.R., –≥–¥–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ pstor –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ. –û–Ω –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–≤–µ—Ä–∏ –¥–ª—è:

–ì–ª—É–±–æ–∫–æ–π –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
–°–ª–æ–∂–Ω—ã—Ö —Å—é–∂–µ—Ç–Ω—ã—Ö –≤–µ—Ç–≤–ª–µ–Ω–∏–π
–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–∏—Ä–∞ –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏
–ü—Ä–∏ —ç—Ç–æ–º –æ–Ω –æ—Å—Ç–∞—ë—Ç—Å—è —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–º —Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ –∂–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è, —á—Ç–æ –∏ —Å–∞–º–∞ –∏–≥—Ä–∞ ‚Äî –ø—Ä–æ—Å—Ç–æ "—É–º–Ω–µ–µ".

–°–æ–≤–µ—Ç: –µ—Å–ª–∏ –≤—ã –ø–∏—à–µ—Ç–µ –º–æ–¥ —Å –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–π ‚Äî –Ω–∞—á–∏–Ω–∞–π—Ç–µ —Å se_stor —Å—Ä–∞–∑—É. –ü–µ—Ä–µ–Ω–æ—Å —Å pstor –ø–æ—Ç–æ–º –±—É–¥–µ—Ç –±–æ–ª–µ–∑–Ω–µ–Ω–Ω—ã–º. 

–ì–æ—Ç–æ–≤–æ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –≤ —Å—Ç–∞—Ç—å—é, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∏–ª–∏ –≥–∞–π–¥ –¥–ª—è –º–æ–¥–¥–µ—Ä–æ–≤!

üîπ–ü–†–ò–ú–ï–†–´üîπ

–ü–æ—á—Ç–∏ —Ç–∞–∫–∂–µ –∫–∞–∫ —Å –ø—Å—Ç–æ—Ä, —Ç–æ–ª—å–∫–æ –º–µ–Ω—å—à–µ –≤–æ–∑–Ω–∏ –∏ –Ω–µ–Ω—É–∂–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π

–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
    SetVar("name_var", cnt)
"name_var" —ç—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è, –∞ cnt —ç—Ç–æ –µ—ë –∑–Ω–∞—á–µ–Ω–∏–µ

–ü–æ–ª—É—á–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
    GetVar("name_var", 0))

–°—á—ë—Ç—á–∏–∫–∏ –∫–∞–∫ –≤ –ø—Å—Ç–æ—Ä:

--' –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å—á—ë—Ç—á–∏–∫–∞ se_stor, —Å—Ç–∞–≤–∏—Ç—Å—è –≤ —Ç–µ –º–µ—Å—Ç–∞ –≥–¥–µ —Ñ—É–Ω–∫—Ü–∏—è –¥–∞—Å—Ç —Ç—Ä—É, —Ç–æ–≥–¥–∞ –∫ —Å—á—ë—Ç—á–∏–∫—É –±—É–¥–µ—Ç –ø—Ä–∏–±–∞–ª–µ–Ω–æ 1
function se_stor_counter_handler(counter_name, counter_limit) 
  local cnt = GetVar(counter_name, 0) + 1 
  if cnt >= counter_limit then 
    SetVar(counter_name, nil) 
    return true 
  else 
    SetVar(counter_name, cnt) 
    return false 
  end 
end


--' –ê–Ω–∞–ª–æ–≥ –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∫–≤–µ—Å—Ç–∞—Ö –∏ –ª—é–±—ã—Ö –ø—Ä–æ–≤–µ—Ä–∫–∞—Ö
function se_stor_counter_greater(name, cnt)
	if name and cnt then
		local c = GetVar(name, 0)
		if c >= cnt then
			SetVar(name, nil)
		return true
		end
	else
		return false
	end
end
